<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>NOMOR SURAT BANDARA TEUKU CUT ALI</title>
  <link href="https://fo.nts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #4a90e2;
      --primary-color-dark: #357ABD;
      --secondary-color: #50e3c2;
      --background-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      --text-color: #333;
      --border-radius: 12px;
      --transition-speed: 0.3s;
      --box-shadow-light: 0 4px 15px rgba(74, 144, 226, 0.2);
      --box-shadow-hover: 0 6px 20px rgba(74, 144, 226, 0.35);
    }

    body {
      font-family: 'Poppins', Arial, sans-serif;
      padding: 40px 20px;
      background: var(--background-gradient);
      color: var(--text-color);
      min-height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h2 {
      color: var(--primary-color-dark);
      text-align: center;
      font-weight: 600;
      margin-bottom: 25px;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }

    form {
      background: white;
      padding: 30px 35px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow-light);
      max-width: 520px;
      width: 100%;
      margin-bottom: 40px;
      transition: box-shadow var(--transition-speed);
    }
    form:hover {
      box-shadow: var(--box-shadow-hover);
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: 500;
      font-size: 0.95rem;
      color: var(--primary-color-dark);
    }

    input, select {
      width: 100%;
      padding: 10px 12px;
      margin-top: 6px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color var(--transition-speed), box-shadow var(--transition-speed);
      outline-offset: 2px;
    }
    input:focus, select:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 8px var(--primary-color);
    }

    button {
      margin-top: 25px;
      padding: 12px 0;
      width: 100%;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-weight: 600;
      font-size: 1.1rem;
      box-shadow: var(--box-shadow-light);
      transition: background-color var(--transition-speed), box-shadow var(--transition-speed), transform var(--transition-speed);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
    }
    button:hover {
      background-color: var(--primary-color-dark);
      box-shadow: var(--box-shadow-hover);
      transform: translateY(-2px);
    }
    button:active {
      transform: translateY(0);
      box-shadow: var(--box-shadow-light);
    }

    table {
      margin: 0 auto 40px auto;
      width: 100%;
      max-width: 900px;
      border-collapse: separate;
      border-spacing: 0 8px;
      background: transparent;
      font-size: 0.95rem;
      box-shadow: none;
    }
    thead tr {
      background-color: var(--primary-color);
      color: white;
      font-weight: 600;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow-light);
    }
    thead th {
      padding: 14px 18px;
      text-align: left;
      border: none;
    }
    tbody tr {
      background: white;
      box-shadow: var(--box-shadow-light);
      transition: box-shadow var(--transition-speed);
      border-radius: var(--border-radius);
    }
    tbody tr:hover {
      box-shadow: var(--box-shadow-hover);
      background-color: #f0f8ff;
    }
    tbody td {
      padding: 14px 18px;
      border: none;
      vertical-align: middle;
    }

    #exportWord, #hapusSemua {
      display: block;
      margin: 0 auto 20px auto;
      padding: 12px 0;
      max-width: 220px;
      width: 100%;
      font-weight: 600;
      font-size: 1rem;
      border-radius: var(--border-radius);
      cursor: pointer;
      box-shadow: var(--box-shadow-light);
      transition: background-color var(--transition-speed), box-shadow var(--transition-speed), transform var(--transition-speed);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
    }
    #exportWord {
      background-color: var(--secondary-color);
      color: var(--primary-color-dark);
      border: none;
    }
    #exportWord:hover {
      background-color: #3ac9b0;
      box-shadow: 0 6px 20px rgba(80, 227, 194, 0.45);
      transform: translateY(-2px);
      color: white;
    }
    #hapusSemua {
      background-color: #e74c3c;
      color: white;
      border: none;
    }
    #hapusSemua:hover {
      background-color: #c0392b;
      box-shadow: 0 6px 20px rgba(231, 76, 60, 0.45);
      transform: translateY(-2px);
    }

    /* Responsive */
    @media (max-width: 600px) {
      form, table {
        width: 100%;
        margin: 0 10px 30px 10px;
      }
      thead tr {
        display: none;
      }
      tbody tr {
        display: block;
        margin-bottom: 15px;
        box-shadow: var(--box-shadow-light);
      }
      tbody td {
        display: flex;
        justify-content: space-between;
        padding: 10px 15px;
        border-bottom: 1px solid #ddd;
      }
      tbody td:last-child {
        border-bottom: none;
      }
      tbody td::before {
        content: attr(data-label);
        font-weight: 600;
        color: var(--primary-color-dark);
      }
    }
  </style>
</head>
<body>

  <h2>NOMOR SURAT BANDARA TEUKU CUT ALI</h2>
  <form id="formSurat">
    <label for="startNomor">Nomor Surat:</label>
    <input type="number" id="startNomor" name="startNomor" value="1" required>

    <label for="kode">Kode Klasifikasi:</label>
    <select id="kode" name="kode" required>
      <option value="KP">KP (Kepegawaian)</option>
      <option value="PR">PR (Perencanaan)</option>
      <option value="KU">KU (Keuangan)</option>
      <option value="PL">PL (Perlengkapan)</option>
      <option value="PM">PM (Penanaman Modal)</option>
      <option value="HK">HK (Hukum)</option>
      <option value="UM">UM (Umum)</option>
      <option value="IP">IP (Informasi Publik)</option>
      <option value="HL">HL (Hubungan Antar Lembaga)</option>
      <option value="KL">KL (Kerjasama dan Fasilitas Kemitraan/Investasi dan Hubungan Luar Negeri)</option>
      <option value="PS">PS (Pengawasan)</option>
      <option value="SM">SM (Pengembangan SDM)</option>
      <option value="LT">LT (Penelitian dan Pengembangan)</option>
      <option value="PT">PT (Pengelolaann Transportasi Berkelanjutan)</option>
      <option value="TI">TI (Teknologi Informasi dan Komunikasi)</option>
      <option value="AJ">AJ (Angkutan Jalan)</option>
      <option value="TJ">TJ (Transportasi Jabodetabek)</option>
      <option value="AP">AP (Angkutan Sungai Danau dan Penyebrangan)</option>
      <option value="AL">AL (Angkutan Laut)</option>
      <option value="AU">HK (Angkutan Udara)</option>
      <option value="KA">KA (Kereta Api)</option>
      <option value="MP">MP (Mahkamah Pelayaran)</option>
      <option value="IK">KA (Investigasi Kecelakaan)</option>
    </select>

    <label for="kodeKP" id="labelKodeKP" style="display:none; margin-top: 15px;">Kode Anak Persoalan:</label>
    <select id="kodeKP" name="kodeKP" style="display:none;">
      <optgroup label="Kepegawaian">  
      <option value="KP.001">KP.001 (Data Kepegawaian)</option>
      <option value="KP.002">KP.002 (Identitas Pegawai)</option>
      <option value="KP.003">KP.003 (Daftar Nominatif)</option>
      <option value="KP.004">KP.004 (Penugasan dan Perintah)</option>
      <option value="KP.005">KP.005 (Penghargaan)</option>
      <option value="KP.006">KP.006 (Pendelegasian Wewenang)</option>
      <option value="KP.007">KP.007 (Sumpah Pegawai / Penghentian Pegawai)</option>
      <option value="KP.008">KP.008 (Spesimen Tanda Tangan / Paraf)</option>
      <option value="KP.009">KP.009 (Daftar Kepangkatan)</option>
      <option value="KP.010">KP.010 (Laporan Harta Kekayaan)</option>
      <option value="KP.011">KP.011 (Cuti)</option>
      <option value="KP.012">KP.012 (Pernikahan)</option>
      <option value="KP.013">KP.013 (Absensi)</option>
      <option value="KP.014">KP.014 (Izin Pegawai)</option>

      <optgroup label="1. Rencana Kepegawaian">
        <option value="KP.101">KP.101 (Formasi Pegawai)</option>
        <option value="KP.102">KP.102 (Analisi Jabatan)</option>
        <option value="KP.103">KP.103 (Penerimaan Pegawai)</option>
        <option value="KP.104">KP.104 (Pengangkatan Pegawai)</option>
        <option value="KP.105">KP.105 (Pengangkatan Jabatan)</option>
        <option value="KP.106">KP.106 (Penempatan)</option>
        <option value="KP.107">KP.107 (Pengendalian Pengangkatan)</option>
        <option value="KP.108">KP.108 (Dispensasi Jabatan)</option>
        <option value="KP.109">KP.109 (Pendayagunaan/Pembinaan Sumber Daya Manusia)</option>
        <option value="KP.110">KP.110 (Tenaga Kerja Dibidang Perhubungan)</option>
        <option value="KP.111">KP.111 (Penilaian)</option>
        <option value="KP.112">KP.112 (Evaluasi)</option>
        <option value="KP.113">KP.113 (Pembibitaan SDM)</option>
        <option value="KP.114">KP.114 (Magang)</option>
      </optgroup>

      <optgroup label="2. Penggajian Pegawai">
        <option value="KP.201">KP.201 (Penggajian)</option>
        <option value="KP.202">KP.202 (Pendaftaran Keluarga)</option>
        <option value="KP.203">KP.203 (Uang Makan)</option>
      </optgroup>

      <optgroup label="3. Tata Mutasi">
        <option value="KP.301">KP.301 (Baperjakat)</option>
        <option value="KP.302">KP.302 (Kenaikan Pangkat/Kenaikan Jabatan)</option>
        <option value="KP.303">KP.303 (Mutasi Jabatan)</option>
        <option value="KP.304">KP.304 (Peta Pemangku Jabatan)</option>
        <option value="KP.305">KP.305 (Mutasi)</option>
        <option value="KP.306">KP.306 (Masa Kerja)</option>
        <option value="KP.307">KP.307 (Pembantuan)</option>
        <option value="KP.308">KP.308 (Inpassing)</option>
        <option value="KP.309">KP.309 (Pemanggilan Pejabat)</option>
        <option value="KP.310">KP.310 (Serah Terima Jabatan)</option>
        <option value="KP.311">KP.311 (Assesment Pegawai)</option>
      </optgroup>

      <optgroup label="4. Penilaian">
        <option value="KP.401">KP.401 (Ujian Dinas)</option>
        <option value="KP.402">KP.402 (Sanksi Kepegawaian)</option>
        <option value="KP.403">KP.403 (Hukuman)</option>
        <option value="KP.404">KP.404 (Rehabilitas)</option>
        <option value="KP.405">KP.405 (Disiplin Pegawai)</option>
        <option value="KP.406">KP.406 (Kinerja Pegawai)</option>
        <option value="KP.407">KP.407 (Angka Kredit Jabatan Fungsional)</option>
      </optgroup>

      <optgroup label="5. Kesejahteraan Pegawai">
        <option value="KP.501">KP.501 (Kesehatan)</option>
        <option value="KP.502">KP.502 (Asuransi)</option>
        <option value="KP.503">KP.503 (Bantuan Pegawai)</option>
        <option value="KP.504">KP.504 (Olah Raga)</option>
        <option value="KP.505">KP.505 (Pembinaan Mental)</option>
        <option value="KP.506">KP.506 (Orang Tua Asuh)</option>
        <option value="KP.507">KP.507 (Psikologi)</option>
        <option value="KP.508">KP.508 (Psikogram)</option>
        <option value="KP.509">KP.509 (Pembekalan Pensiun)</option>
      </optgroup>

      <optgroup label="6. Pemberhentian">
        <option value="KP.601">KP.601 (Pemberhentian Dengan Hormat)</option>
        <option value="KP.602">KP.602 (Pemberhentiang Deangan Tidak Hormat)</option>
        <option value="KP.603">KP.603 (Masa Periapan Pensiun (MPP))</option>
        <option value="KP.604">KP.604 (Uang Tunggu Pensiun)</option>
      </optgroup>

      <optgroup label="7. Pensiun">
        <option value="KP.701">KP.701 (Batas Usia Pensiun (BUP))</option>
        <option value="KP.702">KP.702 (Pensiun Janda/Duda/Anak)</option>
        <option value="KP.703">KP.703 (Pensiun Meninggal Dunia/tewas)</option>
        <option value="KP.704">KP.704 (Pensiun Keuzunan)</option>
        <option value="KP.705">KP.705 (Pensiun Atas Permintaan Sendiri)</option>
      </optgroup>

      <optgroup label="8. Perkumpulan Pegawai">
        <option value="KP.801">KP.801 (Perkumpulan)</option>
        <option value="KP.802">KP.802 (Kewanitaan/Dharmawanita)</option>
        <option value="KP.803">KP.803 (Koperasi,  Kantin, Wisma Peristirahatan)</option>
      </optgroup>

      <optgroup label="9. Organisasi dan Tata Laksana">
        <option value="KP.901">KP.901 (Organisasi)</option>
        <option value="KP.902">KP.902 (Tata Laksana)</option>
        <option value="KP.903">KP.903 (Pembakuan Sarana Kerja)</option>
        <option value="KP.904">KP.904 (Reformasi Birokrasi)</option>
        <option value="KP.905">KP.905 (Peta Jabatan)</option>
      </optgroup>
    </select>

    <label for="kodePR" id="labelKodePR" style="display:none; margin-top: 15px;">Kode Anak Persoalan:</label>
    <select id="kodePR" name="kodePR" style="display:none;">
      <optgroup label="Perencanaan">
        <option value="PR.001">PR.001 (Rencana Strategis)</option>
        <option value="PR.002">PR.002 (Rencana Operasional)</option>
        <option value="PR.003">PR.003 (Evaluasi Rencana)</option>
        <option value="PR.004">PR.004 (Pengembangan Program)</option>
        <option value="PR.005">PR.005 (Analisis Kebutuhan)</option>
      </optgroup>
    </select>

    <label for="kodeKU" id="labelKodeKU" style="display:none; margin-top: 15px;">Kode Anak Persoalan:</label>
    <select id="kodeKU" name="kodeKU" style="display:none;">
      <optgroup label="Keuangan">
        <option value="KU.001">KU.001 (Anggaran)</option>
        <option value="KU.002">KU.002 (Pengeluaran)</option>
        <option value="KU.003">KU.003 (Penerimaan)</option>
        <option value="KU.004">KU.004 (Laporan Keuangan)</option>
        <option value="KU.005">KU.005 (Audit)</option>
      </optgroup>
    </select>

    <label for="kodePL" id="labelKodePL" style="display:none; margin-top: 15px;">Kode Anak Persoalan:</label>
    <select id="kodePL" name="kodePL" style="display:none;">
      <optgroup label="Perlengkapan">
        <option value="PL.001">PL.001 (Anggaran)</option>
        <option value="PL.002">PL.002 (Pengeluaran)</option>
        <option value="PL.003">PL.003 (Penerimaan)</option>
        <option value="PL.004">PL.004 (Laporan Keuangan)</option>
        <option value="PL.005">PL.005 (Audit)</option>
      </optgroup>
    </select>

    <label for="lembar">Lembar Surat:</label>
    <input type="number" id="lembar" name="lembar" value="1" required>

    <label for="unit">Unit Pengirim:</label>
    <input type="text" id="unit" name="unit" required>

    <label for="judul">Judul Surat:</label>
    <input type="text" id="judul" name="judul" required>

    <button type="submit">Buat Nomor Surat</button>
  </form>

  <h2>Daftar Surat</h2>
  <label for="filterKode">Filter Kode:</label>
  <input type="text" id="filterKode" placeholder="Masukkan kode, misal KP.001 atau KP" style="margin-bottom: 10px; padding: 5px; width: 200px;">
  <table id="daftarSurat">
    <thead>
      <tr>
        <th>No</th>
        <th>Nomor Surat</th>
        <th>Judul Surat</th>
        <th>Tanggal & Waktu Keluar</th>
        <th>Lembar</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>

  <button id="exportWord">Export ke Word</button>
  <button id="hapusSemua" style="display:block; margin: 20px auto; padding: 10px; background-color: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer;">🗑️ Hapus Semua</button>

<script>
const form = document.getElementById("formSurat");
const tbody = document.querySelector("#daftarSurat tbody");

let nomorUrutPerGroup = {};
let jumlahSuratPerGroup = {};
let isStartSetPerGroup = {};

function saveData() {
  const rows = [];
  tbody.querySelectorAll("tr").forEach(tr => {
    const cells = tr.querySelectorAll("td");
    rows.push({
      nomorUrut: cells[0].textContent,
      nomorSurat: cells[1].textContent,
      judul: cells[2].textContent,
      waktuLengkap: cells[3].textContent,
      lembar: cells[4].textContent
    });
  });
  localStorage.setItem("daftarSurat", JSON.stringify(rows));
}

function loadData(filterKode = "") {
  const data = localStorage.getItem("daftarSurat");
  if (data) {
    const rows = JSON.parse(data);

    // Group rows by full kode (including kode anak persoalan) before first slash
    const grouped = {};
    rows.forEach(row => {
      const kode = row.nomorSurat.split('/')[0]; // full code like KP.001 or KP
      if (!grouped[kode]) {
        grouped[kode] = [];
      }
      grouped[kode].push(row);
    });

    // Update nomorUrutPerGroup and jumlahSuratPerGroup based on existing data
    Object.keys(grouped).forEach(kode => {
      const nomorUrutMax = grouped[kode].reduce((max, row) => {
        const nomorUrut = parseInt(row.nomorUrut);
        return nomorUrut > max ? nomorUrut : max;
      }, 0);
      nomorUrutPerGroup[kode] = nomorUrutMax + 1;
      jumlahSuratPerGroup[kode] = grouped[kode].length;
    });

    // Clear tbody before rendering
    tbody.innerHTML = "";

    // If filterKode is set, only show that group
    const keysToShow = filterKode ? [filterKode] : Object.keys(grouped);

    keysToShow.forEach(kode => {
      if (!grouped[kode]) return;

        // Insert group header row
        const headerTr = document.createElement("tr");
        headerTr.classList.add("group-header");
        headerTr.style.backgroundColor = "#d9eaff";
        headerTr.style.fontWeight = "600";
        headerTr.innerHTML = `<td colspan="5">Kode: ${kode}</td>`;
        tbody.appendChild(headerTr);

      grouped[kode].forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row.nomorUrut}</td>
          <td>${row.nomorSurat}</td>
          <td>${row.judul}</td>
          <td>${row.waktuLengkap}</td>
          <td>${row.lembar}</td>
        `;
        tbody.appendChild(tr);
      });
    });

    // Set form startNomor and lembar based on first group or default
    const firstGroup = keysToShow[0];
    if (firstGroup && nomorUrutPerGroup[firstGroup]) {
      form.startNomor.value = nomorUrutPerGroup[firstGroup];
      form.lembar.value = Math.ceil(jumlahSuratPerGroup[firstGroup] / 9);
    } else {
      form.startNomor.value = 1;
      form.lembar.value = 1;
    }
  }
}

form.addEventListener("submit", function(e) {
  e.preventDefault();

  const kode = form.kode.value;
  const kodeKP = form.kodeKP.value;
  const kodePR = form.kodePR.value;
  const kodeKU = form.kodeKU.value;
  const kodePL = form.kodePL.value;
  const unit = form.unit.value.toUpperCase();
  const judul = form.judul.value;
  const now = new Date();

  const tahun = now.getFullYear();
  const tanggal = now.toISOString().split("T")[0];
  const jam = now.getHours().toString().padStart(2, '0');
  const menit = now.getMinutes().toString().padStart(2, '0');
  const waktuLengkap = `${tanggal} ${jam}:${menit}`;

  let kodeFinal = kode;
  if (kode === "KP" && kodeKP) {
    kodeFinal = kodeKP;
  } else if (kode === "PR" && kodePR) {
    kodeFinal = kodePR;
  } else if (kode === "KU" && kodeKU) {
    kodeFinal = kodeKU;
  } else if (kode === "PL" && kodePL) {
    kodeFinal = kodePL;
  } else if (kode === "PM" && kodePM) {
    kodeFinal = kodePM;
  } else if (kode === "HK" && kodeHK) {
    kodeFinal = kodeHK;
  } else if (kode === "UM" && kodeUM) {
    kodeFinal = kodeUM;
  }

  if (!nomorUrutPerGroup[kodeFinal]) {
    nomorUrutPerGroup[kodeFinal] = parseInt(form.startNomor.value) || 1;
  }
  if (!jumlahSuratPerGroup[kodeFinal]) {
    jumlahSuratPerGroup[kodeFinal] = 0;
  }

  jumlahSuratPerGroup[kodeFinal]++;
  const nomorUrut = nomorUrutPerGroup[kodeFinal]++;
  const lembar = Math.ceil(jumlahSuratPerGroup[kodeFinal] / 9);

  const nomorSurat = `${kodeFinal}/${lembar}/${nomorUrut}/${unit}-${tahun}`;

  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td>${nomorUrut}</td>
    <td>${nomorSurat}</td>
    <td>${judul}</td>
    <td>${waktuLengkap}</td>
    <td>${lembar}</td>
  `;

  tbody.appendChild(tr);

  form.reset();
  form.startNomor.value = nomorUrutPerGroup[kodeFinal];
  form.lembar.value = lembar;

  saveData();
});

  document.getElementById("exportWord").addEventListener("click", function() {
  const filterKode = document.getElementById("filterKode").value.trim();
  const rows = document.querySelectorAll("#daftarSurat tbody tr");

  let header = `
    <html xmlns:o='urn:schemas-microsoft-com:office:office'
          xmlns:w='urn:schemas-microsoft-com:office:word'
          xmlns='http://www.w3.org/TR/REC-html40'>
    <head><title>Export HTML to Word</title>
  <style>
      @page Section1 {
        size:29.7cm 21cm;
        mso-page-orientation:landscape;
        margin:1.5cm;
      }
      div.Section1 { page:Section1; }
      table { width:100%; border-collapse:collapse; }
      th, td { border:1px solid #000; padding:8px; text-align:left; line-height: 1.2; height: 1.2em; }
      th { background-color:#eee; }
      tr.group-header {
        background-color: #d9eaff;
        font-weight: 600;
      }
    </style>
    </head><body>`;

  let footer = "</body></html>";
  let output = "";
  let currentKode = "";
  let currentLembar = 1;
  let counter = 0;
  let rowsExported = 0;

  for (let i = 0; i < rows.length; i++) {
    // Skip group header rows in the table (they have class group-header)
    if (rows[i].classList.contains("group-header")) {
      continue;
    }

    const nomorSurat = rows[i].cells[1].textContent;
    const kode = nomorSurat.split('/')[0]; // full code including anak persoalan
    const lembarRow = parseInt(rows[i].cells[4].textContent);

    // Only export rows matching the filterKode or if filterKode is empty export all
    if (filterKode && kode !== filterKode) {
      continue;
    }

    if (kode !== currentKode) {
      if (counter !== 0) {
        output += "</tbody></table><div style='page-break-before:always;'></div>";
      }
      output += `<div class="Section1"><table><thead><tr>
        <th colspan="4">Kode: ${kode}</th>
      </tr></thead></table>`;

      output += `<div class="Section1"><table><thead><tr>
        <th>No</th>
        <th>Nomor Surat</th>
        <th>Judul Surat</th>
        <th>Tanggal & Waktu Keluar</th>
      </tr></thead><tbody>`;

      currentKode = kode;
      currentLembar = lembarRow;
      counter = 0;
    }

    if (counter === 9 || lembarRow !== currentLembar) {
      output += "</tbody></table><div style='page-break-before:always;'></div>";
      output += `<div class="Section1"><table><thead><tr>
        <th>No</th>
        <th>Nomor Surat</th>
        <th>Judul Surat</th>
        <th>Tanggal & Waktu Keluar</th>
      </tr></thead><tbody>`;
      currentLembar = lembarRow;
      counter = 0;
    }

    output += `<tr>
      <td>${rows[i].cells[0].textContent}</td>
      <td>${rows[i].cells[1].textContent}</td>
      <td>${rows[i].cells[2].textContent}</td>
      <td>${rows[i].cells[3].textContent}</td>
    </tr>`;

    counter++;
    rowsExported++;
  }

  output += "</tbody></table></div>";

  if (rowsExported === 0) {
    alert("Tidak ada data yang cocok dengan filter untuk diekspor.");
    return;
  }

  const sourceHTML = header + output + footer;

  const source = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(sourceHTML);
  const fileDownload = document.createElement("a");
  document.body.appendChild(fileDownload);
  fileDownload.style.display = 'none';
  fileDownload.href = source;
  fileDownload.download = 'Riwayat_Surat.doc';
  fileDownload.click();
  setTimeout(() => {
    document.body.removeChild(fileDownload);
  }, 100);
});

document.getElementById("hapusSemua").addEventListener("click", function() {
  while (tbody.firstChild) {
    tbody.removeChild(tbody.firstChild);
  }
  localStorage.removeItem("daftarSurat");
  jumlahSurat = 0;
  nomorUrut = 1;
  form.startNomor.value = 1;
  form.lembar.value = 1;
});

window.addEventListener("load", function() {
  loadData();

  // Show or hide kodeKP, kodePR, kodeKU selects based on kode select value
  const kodeSelect = document.getElementById("kode");
  const kodeKPSelect = document.getElementById("kodeKP");
  const labelKodeKP = document.getElementById("labelKodeKP");
  const kodePRSelect = document.getElementById("kodePR");
  const labelKodePR = document.getElementById("labelKodePR");
  const kodeKUSelect = document.getElementById("kodeKU");
  const labelKodeKU = document.getElementById("labelKodeKU");
  const kodePLSelect = document.getElementById("kodePL");
  const labelKodePL = document.getElementById("labelKodePL");
  const filterKodeInput = document.getElementById("filterKode");

  function updateStartNomorAndLembar(kodeFinal) {
    if (nomorUrutPerGroup[kodeFinal]) {
      form.startNomor.value = nomorUrutPerGroup[kodeFinal];
    } else {
      form.startNomor.value = 1;
    }
    if (jumlahSuratPerGroup[kodeFinal]) {
      form.lembar.value = Math.ceil(jumlahSuratPerGroup[kodeFinal] / 9);
    } else {
      form.lembar.value = 1;
    }
  }

  function toggleKodeDetail() {
    if (kodeSelect.value === "KP") {
      kodeKPSelect.style.display = "block";
      labelKodeKP.style.display = "block";
      kodeKPSelect.required = true;
      updateStartNomorAndLembar(kodeKPSelect.value || "KP.001");
    } else {
      kodeKPSelect.style.display = "none";
      labelKodeKP.style.display = "none";
      kodeKPSelect.required = false;
      kodeKPSelect.value = "";
    }

    if (kodeSelect.value === "PR") {
      kodePRSelect.style.display = "block";
      labelKodePR.style.display = "block";
      kodePRSelect.required = true;
      updateStartNomorAndLembar(kodePRSelect.value || "PR.001");
    } else {
      kodePRSelect.style.display = "none";
      labelKodePR.style.display = "none";
      kodePRSelect.required = false;
      kodePRSelect.value = "";
    }

    if (kodeSelect.value === "KU") {
      kodeKUSelect.style.display = "block";
      labelKodeKU.style.display = "block";
      kodeKUSelect.required = true;
      updateStartNomorAndLembar(kodeKUSelect.value || "KU.001");
    } else {
      kodeKUSelect.style.display = "none";
      labelKodeKU.style.display = "none";
      kodeKUSelect.required = false;
      kodeKUSelect.value = "";
    }
    if (kodeSelect.value === "PL") {
      kodePLSelect.style.display = "block";
      labelKodePL.style.display = "block";
      kodePLSelect.required = true;
      updateStartNomorAndLembar(kodePLSelect.value || "PL.001");
    } else {
      kodePLSelect.style.display = "none";
      labelKodePL.style.display = "none";
      kodePLSelect.required = false;
      kodePLSelect.value = "";
    }
    if (!["KP", "PR", "KU", "PL"].includes(kodeSelect.value)) {
      updateStartNomorAndLembar(kodeSelect.value);
    }
  }

  kodeSelect.addEventListener("change", () => {
    toggleKodeDetail();
    // Update filter input and reload list based on selected kode anak persoalan or kode utama
    let kodeFinal = kodeSelect.value;
    if (kodeFinal === "KP" && kodeKPSelect.value) {
      kodeFinal = kodeKPSelect.value;
    } else if (kodeFinal === "PR" && kodePRSelect.value) {
      kodeFinal = kodePRSelect.value;
    } else if (kodeFinal === "KU" && kodeKUSelect.value) {
      kodeFinal = kodeKUSelect.value;
    } else if (kodeFinal === "PL" && kodePLSelect.value) {
      kodeFinal = kodePLSelect.value;
    }
    filterKodeInput.value = kodeFinal;
    loadData(kodeFinal);
  });
  kodeKPSelect.addEventListener("change", () => {
    updateStartNomorAndLembar(kodeKPSelect.value);
    filterKodeInput.value = kodeKPSelect.value;
    loadData(kodeKPSelect.value);
  });
  kodePRSelect.addEventListener("change", () => {
    updateStartNomorAndLembar(kodePRSelect.value);
    filterKodeInput.value = kodePRSelect.value;
    loadData(kodePRSelect.value);
  });
  kodeKUSelect.addEventListener("change", () => {
    updateStartNomorAndLembar(kodeKUSelect.value);
    filterKodeInput.value = kodeKUSelect.value;
    loadData(kodeKUSelect.value);
  });
  kodePLSelect.addEventListener("change", () => {
    updateStartNomorAndLembar(kodePLSelect.value);
    filterKodeInput.value = kodePLSelect.value;
    loadData(kodePLSelect.value);
  });

  filterKodeInput.addEventListener("input", () => {
    loadData(filterKodeInput.value.trim());
  });

  toggleKodeDetail();

});
</script>

</body>
</html>
